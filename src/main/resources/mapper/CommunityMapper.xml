<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.ptever.mapper.CommunityMapper">
    <select id="selectAll" resultType="postDTO">
        SELECT P.POST_ID, P.COMMUNITY_ID, P.USER_ID, P.POST_TITLE, P.POST_CONTENT, P.POST_DATE, P.POST_UPDATE_DATE, C.COMMUNITY_TYPE
        FROM TBL_POST P
        JOIN TBL_COMMUNITY C
        ON P.COMMUNITY_ID = C.COMMUNITY_ID
        ORDER BY P.POST_ID DESC
    </select>

    <select id="selectByPostId" resultType="postDTO">
        SELECT P.POST_ID, P.COMMUNITY_ID, P.USER_ID, P.POST_TITLE, P.POST_CONTENT, P.POST_DATE, P.POST_UPDATE_DATE, C.COMMUNITY_TYPE, U.USER_NICKNAME
        FROM TBL_POST P
        JOIN TBL_COMMUNITY C
        ON P.COMMUNITY_ID = C.COMMUNITY_ID
        JOIN TBL_USER U
        ON P.USER_ID = U.USER_ID
        WHERE P.POST_ID = #{postId}
    </select>

    <select id="selectAllByCommunityId" resultType="postDTO">
        SELECT P.POST_ID, P.COMMUNITY_ID, P.USER_ID, P.POST_TITLE, P.POST_CONTENT, P.POST_DATE, P.POST_UPDATE_DATE, U.USER_NICKNAME
        FROM TBL_POST P
        JOIN TBL_USER U
        ON P.USER_ID = U.USER_ID
        WHERE P.COMMUNITY_ID = #{communityId}
        ORDER BY P.POST_ID DESC
    </select>

    <select id="selectAllByUserId" resultType="postDTO">
        SELECT P.POST_ID, P.COMMUNITY_ID, P.USER_ID, P.POST_TITLE, P.POST_CONTENT, P.POST_DATE, P.POST_UPDATE_DATE, U.USER_NICKNAME
        FROM TBL_POST P
        JOIN TBL_USER U
        ON P.USER_ID = U.USER_ID
        WHERE P.USER_ID = #{userId}
    </select>

    <delete id="deleteCommentByPostId">
        DELETE FROM TBL_COMMUNITY_COMMENT
        WHERE POST_ID = #{postId}
    </delete>

    <delete id="deleteByPostId">
        DELETE FROM TBL_POST
        WHERE POST_ID = #{postId}
    </delete>
</mapper>